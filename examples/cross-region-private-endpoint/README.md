<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Cross-Region Private Endpoint Example

This example demonstrates creating an Event Grid Topic in one Azure region with a Private Endpoint in a different region.

## Scenario

This is a common enterprise scenario where:
- The Event Grid Topic is deployed in a specific region (e.g., East US) for data residency or latency requirements
- The consuming application's VNet exists in a different region (e.g., West US 2)
- A private endpoint is needed to securely access the Event Grid Topic from the remote VNet

## Key Configuration

The `location` parameter in the `private_endpoints` configuration must be set to the region where the VNet exists:

```hcl
private_endpoints = {
  pe_crossregion = {
    subnet_resource_id = azurerm_subnet.pe.id  # Subnet in West US 2
    location           = "westus2"              # Must match the VNet region
  }
}
```

Without the correct `location` parameter, the private endpoint would be created in the Event Grid Topic's region, causing an `InvalidResourceReference` error because the subnet cannot be found in that region.

```hcl
terraform {
  required_version = "~> 1.5"

  required_providers {
    azapi = {
      source  = "Azure/azapi"
      version = "~> 2.0"
    }
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 4.0"
    }
    random = {
      source  = "hashicorp/random"
      version = "~> 3.0"
    }
  }
}

provider "azurerm" {
  features {
    resource_group {
      prevent_deletion_if_contains_resources = false
    }
  }
}

# This ensures we have unique CAF compliant names for our resources.
module "naming" {
  source  = "Azure/naming/azurerm"
  version = "0.4.2"
}

# Resource group for the Event Grid Topic (in East US)
resource "azurerm_resource_group" "topic_rg" {
  location = "eastus"
  name     = "${module.naming.resource_group.name_unique}-topic"
}

# Resource group for the VNet (in West US 2) - different region than the topic
resource "azurerm_resource_group" "network_rg" {
  location = "westus2"
  name     = "${module.naming.resource_group.name_unique}-network"
}

# Network resources in West US 2 (different region from the Event Grid Topic)
resource "azurerm_virtual_network" "vnet" {
  location            = azurerm_resource_group.network_rg.location
  name                = "vnet-eventgrid-crossregion"
  resource_group_name = azurerm_resource_group.network_rg.name
  address_space       = ["10.0.0.0/16"]
}

resource "azurerm_subnet" "pe" {
  address_prefixes     = ["10.0.1.0/24"]
  name                 = "snet-eventgrid-pe"
  resource_group_name  = azurerm_resource_group.network_rg.name
  virtual_network_name = azurerm_virtual_network.vnet.name
}

# -----------------------------------------------------------------------------
# Cross-Region Private Endpoint Example
# -----------------------------------------------------------------------------
# This example demonstrates creating an Event Grid Topic in one region (East US)
# with a Private Endpoint in a different region (West US 2).
#
# Prior to the fix in PR #19, this would fail with an "InvalidResourceReference"
# error because the private endpoint was always created in the topic's region,
# ignoring the user-provided `location` parameter.
#
# The fix ensures that when `location` is specified in the private_endpoints
# configuration, it is respected and the private endpoint is created in the
# specified region where the VNet exists.
# -----------------------------------------------------------------------------

module "eventgrid_topic" {
  source = "../../"

  location         = azurerm_resource_group.topic_rg.location # East US
  name             = module.naming.eventgrid_topic.name_unique
  parent_id        = azurerm_resource_group.topic_rg.id
  enable_telemetry = true
  # Private endpoint in a DIFFERENT region than the Event Grid Topic
  # The `location` parameter tells the module where to create the private endpoint
  private_endpoints = {
    pe_crossregion = {
      name                            = "pe-${module.naming.eventgrid_topic.name_unique}-crossregion"
      subnet_resource_id              = azurerm_subnet.pe.id
      private_service_connection_name = "psc-eventgrid-topic-crossregion"

      # This is the key parameter being tested:
      # The private endpoint must be created in the same region as the VNet (West US 2),
      # not in the Event Grid Topic's region (East US).
      location = azurerm_resource_group.network_rg.location # West US 2

      # Optionally, you can also specify a different resource group for the private endpoint
      resource_group_name = azurerm_resource_group.network_rg.name
    }
  }
  private_endpoints_manage_dns_zone_group = true
  tags = {
    environment = "example"
    scenario    = "cross-region-private-endpoint"
  }
}
```

<!-- markdownlint-disable MD033 -->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (~> 1.5)

- <a name="requirement_azapi"></a> [azapi](#requirement\_azapi) (~> 2.0)

- <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) (~> 4.0)

- <a name="requirement_random"></a> [random](#requirement\_random) (~> 3.0)

## Resources

The following resources are used by this module:

- [azurerm_resource_group.network_rg](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) (resource)
- [azurerm_resource_group.topic_rg](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) (resource)
- [azurerm_subnet.pe](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/subnet) (resource)
- [azurerm_virtual_network.vnet](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_network) (resource)

<!-- markdownlint-disable MD013 -->
## Required Inputs

No required inputs.

## Optional Inputs

No optional inputs.

## Outputs

No outputs.

## Modules

The following Modules are called:

### <a name="module_eventgrid_topic"></a> [eventgrid\_topic](#module\_eventgrid\_topic)

Source: ../../

Version:

### <a name="module_naming"></a> [naming](#module\_naming)

Source: Azure/naming/azurerm

Version: 0.4.2

## Related Issue

This example tests the fix implemented in [PR #19](https://github.com/Azure/terraform-azurerm-avm-res-eventgrid-topic/pull/19) which addresses [Issue #17](https://github.com/Azure/terraform-azurerm-avm-res-eventgrid-topic/issues/17).

Prior to the fix, the `location` parameter was ignored and private endpoints were always created in the Event Grid Topic's region, causing deployment failures when the VNet existed in a different region.
<!-- END_TF_DOCS -->